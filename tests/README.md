# Tests Directory

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã—ã¾ã™ã€‚

> **ðŸ“‹ è©³ç´°ãƒ«ãƒ¼ãƒ«**: [ADR-0009: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†è¦å‰‡](../docs/decisions/active/2025/10/20251029_0009_ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†è¦å‰‡testsfixturesé…ä¸‹ã«é›†ç´„_process.md)

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
tests/
â”œâ”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ test_*.py              # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆå°†æ¥çš„ã«ä½œæˆï¼‰â†’ Gitç®¡ç†
â””â”€â”€ fixtures/              # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
    â”œâ”€â”€ permanent/         # å›ºå®šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆå›žå¸°ãƒ†ã‚¹ãƒˆç”¨ï¼‰â†’ Gitç®¡ç†
    â”‚   â””â”€â”€ sample_conversation.md
    â””â”€â”€ temporary/         # ä¸€æ™‚çš„ãªå‹•ä½œç¢ºèªç”¨ â†’ .gitignore
        â””â”€â”€ *.test.txt
```

## ãƒ«ãƒ¼ãƒ«

### 1. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®é…ç½®

#### A. æ’ä¹…çš„ãªãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆGitç®¡ç†ï¼‰
**é…ç½®å…ˆ**: `tests/fixtures/permanent/`

**ç”¨é€”:**
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹å›ºå®šãƒ‡ãƒ¼ã‚¿
- å›žå¸°ãƒ†ã‚¹ãƒˆç”¨ã®å‚ç…§ãƒ‡ãƒ¼ã‚¿
- æ¯Žå›žåŒã˜çµæžœã‚’æœŸå¾…ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

**ä¾‹:**
```bash
# å›ºå®šã•ã‚ŒãŸä¼šè©±ã‚µãƒ³ãƒ—ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆã§æ¯Žå›žä½¿ç”¨ï¼‰
tests/fixtures/permanent/sample_conversation.md
tests/fixtures/permanent/expected_frontmatter.yml
```

**ç‰¹å¾´:**
- âœ… Gitç®¡ç†ã•ã‚Œã‚‹ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼‰
- âœ… å†…å®¹ã¯åŸºæœ¬çš„ã«å¤‰æ›´ã—ãªã„
- âœ… ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆtest_*.pyï¼‰ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹

---

#### B. ä¸€æ™‚çš„ãªå‹•ä½œç¢ºèªç”¨ï¼ˆ.gitignoreï¼‰
**é…ç½®å…ˆ**: `tests/fixtures/temporary/`

**ç”¨é€”:**
- é–‹ç™ºä¸­ã®æ‰‹å‹•å‹•ä½œç¢ºèª
- ãã®å ´é™ã‚Šã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- å®Ÿé¨“çš„ãªè©¦è¡Œ

**ä¾‹:**
```bash
# æ‰‹å‹•ç¢ºèªç”¨ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
tests/fixtures/temporary/quick_test.test.txt
tests/fixtures/temporary/debug_output.test.md
```

**ç‰¹å¾´:**
- âŒ Gitç®¡ç†ã•ã‚Œãªã„ï¼ˆ.gitignoreå¯¾è±¡ï¼‰
- âœ… å‰Šé™¤ã—ã¦ã‚‚å•é¡Œãªã„
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `*.test.txt` ã¾ãŸã¯ `*.test.md` æŽ¨å¥¨

---

### 2. åˆ¤æ–­åŸºæº–ï¼šã©ã¡ã‚‰ã«ç½®ãã¹ãã‹ï¼Ÿ

| è³ªå• | permanent/ | temporary/ |
|------|-----------|-----------|
| ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆtest_*.pyï¼‰ã‹ã‚‰ä½¿ã†ï¼Ÿ | âœ… | âŒ |
| æ¯Žå›žåŒã˜å†…å®¹ã‚’æœŸå¾…ã™ã‚‹ï¼Ÿ | âœ… | âŒ |
| å‰Šé™¤ã—ãŸã‚‰å›°ã‚‹ï¼Ÿ | âœ… | âŒ |
| ä»–ã®äººï¼ˆAIå«ã‚€ï¼‰ã‚‚ä½¿ã†ï¼Ÿ | âœ… | âŒ |
| ãã®å ´é™ã‚Šã®ç¢ºèªï¼Ÿ | âŒ | âœ… |
| å®Ÿé¨“çš„ãƒ»è©¦è¡ŒéŒ¯èª¤ç”¨ï¼Ÿ | âŒ | âœ… |

**è¿·ã£ãŸã‚‰**: ã¾ãš `temporary/` ã«ç½®ã„ã¦ã€å¾Œã§å¿…è¦ãªã‚‰ `permanent/` ã«æ˜‡æ ¼

---

### 2. .gitignore è¨­å®š

**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿é™¤å¤–:**
```ignore
# Tests - ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿é™¤å¤–
tests/fixtures/temporary/
*.test.txt
*.test.md
```

**Gitç®¡ç†ã•ã‚Œã‚‹ã‚‚ã®:**
- `tests/test_*.py` - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- `tests/fixtures/permanent/` - å›ºå®šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- `tests/README.md` - ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«

---

### 3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆrootç›´ä¸‹ã¸ã®é…ç½®ç¦æ­¢

âŒ **çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„:**
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆrootã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
/Users/.../nullvariant/test_conversation.txt  # NG!
```

âœ… **æ­£ã—ã„é…ç½®:**
```bash
# tests/fixtures/temporary/ é…ä¸‹
/Users/.../nullvariant/tests/fixtures/temporary/test_conversation.txt  # OK
```

---

### 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¾‹

#### A. ä¸€æ™‚çš„ãªå‹•ä½œç¢ºèªï¼ˆtemporary/ï¼‰

```bash
# ä¸€æ™‚ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cat > tests/fixtures/temporary/sample_conversation.test.txt << 'EOF'
## å¯¾è©±ä¾‹
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã“ã‚“ã«ã¡ã¯
AI: ã¯ã„ã€ã©ã†ãž
EOF

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python scripts/archive_conversation.py \
  --topic "ãƒ†ã‚¹ãƒˆ" \
  --conversation-file tests/fixtures/temporary/sample_conversation.test.txt

# ãƒ†ã‚¹ãƒˆå¾Œã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã—ã¦ã‚‚å•é¡Œãªã—
rm tests/fixtures/temporary/sample_conversation.test.txt
```

---

#### B. æ’ä¹…çš„ãªãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆpermanent/ï¼‰- å°†æ¥çš„ã«ä½¿ç”¨

```bash
# å›ºå®šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆGitç®¡ç†ï¼‰
cat > tests/fixtures/permanent/standard_conversation.md << 'EOF'
## æ¨™æº–çš„ãªå¯¾è©±ãƒ‘ã‚¿ãƒ¼ãƒ³
ãƒ¦ãƒ¼ã‚¶ãƒ¼: Phase 2ã‚’é–‹å§‹ã—ã¾ã™
AI: æ‰¿çŸ¥ã—ã¾ã—ãŸ
EOF

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
# tests/test_archive_conversation.py
def test_with_permanent_fixture():
    with open('tests/fixtures/permanent/standard_conversation.md') as f:
        content = f.read()
    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ...
```

---

#### C. check_token_usage.py ã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼‰

```bash
# é€šå¸¸å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼‰
python scripts/check_token_usage.py

# è©³ç´°ãƒ¢ãƒ¼ãƒ‰
python scripts/check_token_usage.py --detailed
```

---

### 5. AI ã¸ã®æŒ‡ç¤ºï¼ˆé‡è¦ï¼‰

**Claude Code / GitHub Copilot å‘ã‘ãƒ«ãƒ¼ãƒ«:**

1. âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆæ™‚ã¯ `tests/fixtures/temporary/` ã«ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
2. âŒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆrootã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆç¦æ­¢
3. âœ… ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `*.test.txt` ã¾ãŸã¯ `*.test.md` æŽ¨å¥¨
4. âœ… ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã§ä½¿ã†å›ºå®šãƒ‡ãƒ¼ã‚¿ã¯ `permanent/` ã«é…ç½®
5. âš ï¸ äººé–“ãŒrootã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ãŸã‚‰è­¦å‘Š

---

## æ³¨æ„äº‹é …

- ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `../nullvariant-writings/docs/log/` ã«ä¿å­˜ã•ã‚Œã‚‹
- `--auto-commit` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä½¿ç”¨æ™‚ã¯å®Ÿéš›ã«Gitã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã®ã§æ³¨æ„
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«å€‹äººæƒ…å ±ã‚’å«ã‚ãªã„
